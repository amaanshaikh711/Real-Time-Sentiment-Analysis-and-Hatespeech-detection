{% extends 'base.html' %}
{% set hide_sidebar = true %}

{% block content %}
<style>
.auth-container {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 2rem 1rem;
  margin-left: 0 !important;
  padding-left: 0 !important;
}
.auth-card {
  width: 100%;
  max-width: 28rem;
  margin: 0 auto;
}

/* Ensure no left spacing on auth pages */
body {
  margin-left: 0 !important;
  padding-left: 0 !important;
}
</style>
<div class="auth-container bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
  <div class="auth-card">
    <!-- Logo and Title -->
    <div class="text-center">
      <lottie-player
        src="https://assets3.lottiefiles.com/packages/lf20_jcikwtux.json"
        background="transparent"
        speed="1"
        style="width: 230px; height: 230px; margin: 0 auto;"
        loop
        autoplay>
      </lottie-player>
      <h2 class="mt-6 text-3xl font-bold text-white" style="margin-top: -12px;">
        Create Your Account
      </h2>
      <p class="mt-2 text-sm text-gray-300">
        Join HateSense AI to start analyzing content
      </p>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="space-y-2">
          {% for category, message in messages %}
            <div class="p-4 rounded-md text-sm {% if category == 'error' %}bg-red-500/20 text-red-300 border border-red-500/30{% else %}bg-green-500/20 text-green-300 border border-green-500/30{% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Registration Form -->
    <form class="mt-8 space-y-6" method="POST" action="{{ url_for('signup') }}" id="signupForm">
      <div class="space-y-4">
        <!-- Username -->
        <div>
         <label for="username" class="block text-sm font-medium text-gray-300 mb-2" style="margin-top: -16px;">
            Username
          </label>
          <input
            id="username"
            name="username"
            type="text"
            required
            class="w-full px-4 py-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
            placeholder="Choose a username"
            value="{{ request.form.username or '' }}"
          >
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
            Email Address
          </label>
          <input
            id="email"
            name="email"
            type="email"
            required
            class="w-full px-4 py-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
            placeholder="your@email.com"
            value="{{ request.form.email or '' }}"
          >
        </div>

        <!-- Password -->
        <div>
          <label for="password" class="block text-sm font-medium text-gray-300 mb-2">
            Password
          </label>
          <input
            id="password"
            name="password"
            type="password"
            required
            class="w-full px-4 py-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
            placeholder="At least 6 characters"
          >
        </div>

        <!-- Confirm Password -->
        <div>
          <label for="confirm_password" class="block text-sm font-medium text-gray-300 mb-2">
            Confirm Password
          </label>
          <input
            id="confirm_password"
            name="confirm_password"
            type="password"
            required
            class="w-full px-4 py-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
            placeholder="Confirm your password"
          >
        </div>
      </div>

      <!-- Terms and Submit -->
      <div class="space-y-4">
        <div class="flex items-center">
          <input
            id="terms"
            name="terms"
            type="checkbox"
            required
            class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-slate-600 rounded bg-slate-800"
          >
          <label for="terms" class="ml-2 block text-sm text-gray-300">
            I agree to the <a href="#" class="text-purple-400 hover:text-purple-300">Terms and Conditions</a>
          </label>
        </div>

        <button
          type="submit"
          class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all transform hover:scale-105"
        >
          Create Account
        </button>
      </div>

      <div class="text-center">
        <p class="text-sm text-gray-300">
          Already have an account?
          <a href="{{ url_for('login') }}" class="font-medium text-purple-400 hover:text-purple-300">
            Sign in here
          </a>
        </p>
      </div>
    </form>

    <!-- Demo Credentials (for testing) -->
    <div class="text-center text-xs text-gray-400">
      <p>Demo: Use any valid email format and password (6+ characters)</p>
      <p class="text-yellow-400">Note: Using local authentication when Supabase is unavailable</p>
    </div>
  </div>
</div>

<script>
// Form validation
document.getElementById('signupForm').addEventListener('submit', function(e) {
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirm_password').value;
  const email = document.getElementById('email').value;
  const username = document.getElementById('username').value;

  // Check password confirmation
  if (password !== confirmPassword) {
    e.preventDefault();
    alert('Passwords do not match. Please try again.');
    return false;
  }

  // Check password length
  if (password.length < 6) {
    e.preventDefault();
    alert('Password must be at least 6 characters long.');
    return false;
  }

  // Check username length
  if (username.length < 3) {
    e.preventDefault();
    alert('Username must be at least 3 characters long.');
    return false;
  }

  // Basic email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    e.preventDefault();
    alert('Please enter a valid email address.');
    return false;
  }

  return true;
});

// Real-time password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
  const password = document.getElementById('password').value;
  const confirmPassword = this.value;
  const button = document.querySelector('button[type="submit"]');

  if (confirmPassword && password !== confirmPassword) {
    this.style.borderColor = '#e74c3c';
    button.disabled = true;
    button.style.opacity = '0.6';
  } else {
    this.style.borderColor = '';
    button.disabled = false;
    button.style.opacity = '1';
  }
});
</script>
{% endblock %}